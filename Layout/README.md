# AsyncPS_for_PCCT

This file provides an example of how to implement the layout and post-layout simulation of the asynchronous constant-delay counter. The open-source [skywater130 PDK](https://github.com/google/skywater-pdk), developed by Google, is used during the entire layout process. Due to limited time, the layouts for the identifier and subtractor are not implemented in this work.

### Cells generation
Unlike the design flow for synchronous circuits, the physical implementation phase of asynchronous circuits cannot be fully automated by merely running scripts. This is 
primarily due to the asymmetric PRS typically generated by asynchronous circuit design methodologies, which often correspond to non-complementary logic gates. However, 
most standard cell libraries within PDKs are designed using complementary logic. Consequently, designers cannot directly map their netlists to the standard cell library, 
necessitating the manual layout of these non-complementary cells. In our work, [MagicVLSI](http://opencircuitdesign.com/magic/) is used to finish the layout of all cells.

In the "cell" file, "counter_b4.act" contains the PRS of the counter and instantiates a 4-bit counter. "interact.src", "magic_cmds", "makefile" and "scaling_mag.pl" can be used to generate the primary cells corresponding to the 4-bit counter, by running:

`make interact`

After this, you could see some new files are generated:

- **lef_def**: contains the lef and def files corresponding to the current design.
- **rect_files**: contains all cells in the format of .rect.
- **tcl_files**: contains all cells in the format of .tcl, which can be read by MagicVLSI.
- **mag_files**: contains all cells in the format of .mag, which are obtained by reading all .tcl files with MagicVLSI and then saving them directly.
- **mag_files_save_tcl_mag**: contains the same .mag files as stored in "mag_files". At this point, designers should finish the cell layout. (The files we uploaded are completed cells.)

Note that we used "scaling_mag.pl" instead of "mag.pl" because we used the up-to-date tech file (sky130A.magicrc) to draw the layout. However, when dealing with all files related to layout process, the ACT tool uses a very generic tech file (sky130l.tech) by default. This leads to serveral compatibility issues between Magic and ACT tool. Therefore, when converting from .rect to .mag and converting from .mag to .rect, some additional scripts are needed to eliminate these issues. Due to the complexity added by using sky130A, **we recommend designers to use the sky130l directly when drawing the layout.**

### Post-layout
After getting the completed cells, we have to first convert them back to .rect format to built a custom cell library for further PnR process. In "\post_layout\mag2rect", you could convert all the cells by running:

`make all`

This results in all the .rect files in "\post_layout\converted_rects". These files need to be scaled by running:

`python3 scale.py ../cell_lib`

Now we get all .rect files stored in "\post_layout\cell_lib", which can be seen as a custom cell library for the counter. Then, the PnR process can be done in "\post_layout" by running:

`interact -Tsky130l interact.src`

Copy and paste the resulting lef and def files into "\post_layout\mag2ext". Here we still need the .mag files which are compatible with sky130l. In "\post_layout\mag2rect", run:

`python3 130A2L.py ../mag2ext`

Now we can load the lef and def files into MagicVLSI and use the built-in command **ext2spice** to generate the netlist for post-layout simulation. Here, the netlist may exhibit different kinds of format issues when being simulated in a SPICE simulator. To test it in Eldo, we first run:

`python3 modify_netlist.py TOP.spice zzz.spice`
